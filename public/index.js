function initScreen(){$("#leave").hide(),$(".video-group").hide()}initScreen();var client=AgoraRTC.createClient({mode:"rtc",codec:"vp8"}),localTracks={videoTrack:null,audioTrack:null},remoteUsers={},options={appid:"adaa9fb7675e4ca19ca80a6762e44dd2",channel:null,uid:null,token:null,userName:null};async function join(){client.on("user-published",handleUserPublished),client.on("user-unpublished",handleUserUnpublished),$("#join").text("Joining..."),[options.uid,localTracks.audioTrack,localTracks.videoTrack]=await Promise.all([client.join(options.appid,options.channel,options.token||null,options.uid||null),AgoraRTC.createMicrophoneAudioTrack(),AgoraRTC.createCameraVideoTrack()]),localTracks.videoTrack.play("local-player"),$("#local-player-name").text(`${options.userName} (You)`),await client.publish(Object.values(localTracks)),console.log("publish success"),$(".form").hide(),$(".tips").hide(),$("hr").hide(),$("#join").hide(),$("#leave").fadeIn(),$(".video-group").fadeIn()}async function leave(){for(trackName in localTracks){var e=localTracks[trackName];e&&(e.stop(),e.close(),localTracks[trackName]=void 0)}remoteUsers={},$("#remote-playerlist").html(""),await client.leave(),$("#local-player-name").text(""),$("#join").attr("disabled",!1),$("#leave").attr("disabled",!0),console.log("client leaves channel success"),$("#leave").text("Leaving..."),setTimeout(()=>{$(".form").show(),$("#join").text("Join"),$("#join").show(),$(".tips").show(),$("hr").show(),$("#leave").text("Leave"),$("#leave").hide()},1e3)}async function subscribe(e,a){const o=e.uid;if(await client.subscribe(e,a),console.log("subscribe success"),"video"===a){const a=$(`\n      <div id="player-wrapper-${o}">\n        <p class="player-name">${o}</p>\n        <div id="player-${o}" class="player"></div>\n      </div>\n    `);$("#remote-playerlist").append(a),e.videoTrack.play(`player-${o}`)}"audio"===a&&e.audioTrack.play()}function handleUserPublished(e,a){const o=e.uid;remoteUsers[o]=e,subscribe(e,a)}function handleUserUnpublished(e){const a=e.uid;delete remoteUsers[a],$(`#player-wrapper-${a}`).remove()}$(()=>{var e=new URL(location.href).searchParams;options.channel=e.get("channel"),options.token=e.get("token"),options.uid=e.get("uid"),options.appid&&options.channel&&($("#uid").val(options.uid),$("#appid").val(options.appid),$("#token").val(options.token),$("#channel").val(options.channel),$("#join-form").submit())}),$("#join-form").submit(async function(e){e.preventDefault(),$("#join").attr("disabled",!0);try{options.appid=$("#appid").val(),options.token=$("#token").val(),options.channel=$("#channel").val(),options.uid=$("#uid").val(),options.userName=$("#userName").val(),await join(),options.token?$("#success-alert-with-token").css("display","block"):($("#success-alert a").attr("href",`index.html?appid=${options.appid}&channel=${options.channel}&token=${options.token}`),$("#success-alert").css("display","block"))}catch(e){console.error(e)}finally{$("#leave").attr("disabled",!1)}}),$("#leave").click(function(e){leave()});
